/**
 * 
 */
o3djs.require('lgb.core');
o3djs.require('lgb.utils');
o3djs.require('lgb.loader');
o3djs.require('lgb.gui');
o3djs.require('lgb.animation');

var lgb = (function(lgb) {
	

	/**
	 * @namespace A module for managing 3D models and their assets.
	 */
	lgb.loader = lgb.loader || {};
	
	lgb.loader.init = function(initCallback) {
		
		jQuery(window).unload(function() {
			//alert('Handler for .unload() called.');
			if (hemi.core.client) {
				hemi.core.client.cleanup();
			}
		});

		this.theModel = null;
		this.msgHandler = null;
		this.count = 0; // Counter to keep track of wall opacity
		this.dir = 1; // Whether wall is becoming more or less opaque
		this.subscriberWorldReady = null;
		this.subscriberCameraStopped = null;
		this.opacity = null;
		this.filePath = 'scene.json';
		this.initCallback = initCallback;
		this.loadCallback = null;
		
		var that = this;

		

				
		lgb.loader.init2 = function(clientElements) {
	
			hemi.core.init(clientElements[0]);
			//that.init3();
			that.initCallback.call();
		};
	

	
		o3djs.webgl.makeClients(this.init2);
		
	};
	
		
	lgb.loader.loadSceneComplete = function(){
		console.log('lgb.loader.loadSceneComplete');
		
		var result = hemi.world.camera.unsubscribe(this.subscriberWorldReady, hemi.msg.stop);

		
		lgb.core.init();
		lgb.gui.init();
		lgb.loader.init();
		lgb.animation.init();
		lgb.utils.init();
		
		this.loadCallback.call();
	};
		
		
	/** 
	 * loads the default scene.json file using the O3d libs
	 *
	 * @param callback function when done
	 * @return {void}
	 */
	lgb.loader.loadScene = function(callback){
			this.loadCallback = callback;
		
			hemi.view.setBGColor([0.8, 0.8, 0.8, 1]);
				
			this.theModel = new hemi.model.Model();	// Create a new Model
			
	
			this.subscriberWorldReady = hemi.world.subscribe(
					hemi.msg.ready,
					this,
					'loadSceneComplete'
				);
			
			this.theModel.setFileName(this.filePath); // Set the model file and load

			hemi.world.ready();   // Indicate that we are ready to start our script

	};
	


	return lgb;
	
})(lgb || {});

